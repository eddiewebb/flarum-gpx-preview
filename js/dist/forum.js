module.exports=function(t){var e={};function o(a){if(e[a])return e[a].exports;var r=e[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=t,o.c=e,o.d=function(t,e,a){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(a,r,function(e){return t[e]}.bind(null,r));return a},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=6)}([function(t,e){t.exports=flarum.core.compat.app},function(t,e){t.exports=flarum.core.compat["common/Model"]},function(t,e){t.exports=flarum.core.compat.extend},function(t,e){t.exports=flarum.core.compat["common/utils/mixin"]},function(t,e){t.exports=flarum.core.compat["components/Post"]},function(t,e){function o(t,e){this.xmlDoc=t,this.map=e,this.trackcolour="#ff00ff",this.trackwidth=5,this.mintrackpointdelta=1e-4}o.prototype.setTrackColour=function(t){this.trackcolour=t},o.prototype.setTrackWidth=function(t){this.trackwidth=t},o.prototype.setMinTrackPointDelta=function(t){this.mintrackpointdelta=t},o.prototype.translateName=function(t){return"wpt"==t?"Waypoint":"trkpt"==t?"Track Point":"rtept"==t?"Route Point":void 0},o.prototype.createMarker=function(t){var e=parseFloat(t.getAttribute("lon")),o=parseFloat(t.getAttribute("lat")),a="",r=t.getElementsByTagName("html");if(r.length>0)for(i=0;i<r.item(0).childNodes.length;i++)a+=r.item(0).childNodes[i].nodeValue;else{a="<b>"+this.translateName(t.nodeName)+"</b><br>";var n=t.attributes,s=n.length;for(i=0;i<s;i++)a+=n.item(i).name+" = "+n.item(i).nodeValue+"<br>";if(t.hasChildNodes){var l=t.childNodes,u=l.length;for(i=0;i<u;i++)1==l[i].nodeType&&null!=l[i].firstChild&&(a+=l[i].nodeName+" = "+l[i].firstChild.nodeValue+"<br>")}}var p=new google.maps.Marker({position:new google.maps.LatLng(o,e),map:this.map}),c=new google.maps.InfoWindow({content:a,size:new google.maps.Size(50,50)});google.maps.event.addListener(p,"click",(function(){c.open(this.map,p)}))},o.prototype.addTrackSegmentToMap=function(t,e,o){var a=t.getElementsByTagName("trkpt");if(0!=a.length){var r=[],n=parseFloat(a[0].getAttribute("lon")),i=parseFloat(a[0].getAttribute("lat")),s=new google.maps.LatLng(i,n);r.push(s);for(var l=1;l<a.length;l++){var u=parseFloat(a[l].getAttribute("lon")),p=parseFloat(a[l].getAttribute("lat")),c=p-i,g=u-n;Math.sqrt(c*c+g*g)>this.mintrackpointdelta&&(n=u,i=p,s=new google.maps.LatLng(p,u),r.push(s))}new google.maps.Polyline({path:r,strokeColor:e,strokeWeight:o,map:this.map})}},o.prototype.addTrackToMap=function(t,e,o){for(var a=t.getElementsByTagName("trkseg"),r=0;r<a.length;r++)this.addTrackSegmentToMap(a[r],e,o)},o.prototype.addRouteToMap=function(t,e,o){var a=t.getElementsByTagName("rtept");if(0!=a.length){var r=[],n=parseFloat(a[0].getAttribute("lon")),i=parseFloat(a[0].getAttribute("lat")),s=new google.maps.LatLng(i,n);r.push(s);for(var l=1;l<a.length;l++){var u=parseFloat(a[l].getAttribute("lon")),p=parseFloat(a[l].getAttribute("lat")),c=p-i,g=u-n;Math.sqrt(c*c+g*g)>this.mintrackpointdelta&&(n=u,i=p,s=new google.maps.LatLng(p,u),r.push(s))}new google.maps.Polyline({path:r,strokeColor:e,strokeWeight:o,map:this.map})}},o.prototype.centerAndZoom=function(t){for(var e=new Array("trkpt","rtept","wpt"),o=0,a=0,r=0,n=0,i=0;i<e.length;i++){var s=t.getElementsByTagName(e[i]);s.length>0&&o==a&&0==o&&(o=parseFloat(s[0].getAttribute("lat")),a=parseFloat(s[0].getAttribute("lat")),r=parseFloat(s[0].getAttribute("lon")),n=parseFloat(s[0].getAttribute("lon")));for(var l=0;l<s.length;l++){var u=parseFloat(s[l].getAttribute("lon")),p=parseFloat(s[l].getAttribute("lat"));u<r&&(r=u),u>n&&(n=u),p<o&&(o=p),p>a&&(a=p)}}if(o!=a||0!=o){var c=(n+r)/2,g=(a+o)/2,d=new google.maps.LatLngBounds(new google.maps.LatLng(o,r),new google.maps.LatLng(a,n));this.map.setCenter(new google.maps.LatLng(g,c)),this.map.fitBounds(d)}else this.map.setCenter(new google.maps.LatLng(49.327667,-122.942333),14)},o.prototype.centerAndZoomToLatLngBounds=function(t){for(var e=new google.maps.LatLngBounds,o=0;o<t.length;o++)t[o].isEmpty()||(e.extend(t[o].getSouthWest()),e.extend(t[o].getNorthEast()));var a=(e.getNorthEast().lat()+e.getSouthWest().lat())/2,r=(e.getNorthEast().lng()+e.getSouthWest().lng())/2;this.map.setCenter(new google.maps.LatLng(a,r),this.map.getBoundsZoomLevel(e))},o.prototype.addTrackpointsToMap=function(){for(var t=this.xmlDoc.documentElement.getElementsByTagName("trk"),e=0;e<t.length;e++)this.addTrackToMap(t[e],this.trackcolour,this.trackwidth)},o.prototype.addWaypointsToMap=function(){for(var t=this.xmlDoc.documentElement.getElementsByTagName("wpt"),e=0;e<t.length;e++)this.createMarker(t[e])},o.prototype.addRoutepointsToMap=function(){for(var t=this.xmlDoc.documentElement.getElementsByTagName("rte"),e=0;e<t.length;e++)this.addRouteToMap(t[e],this.trackcolour,this.trackwidth)},e.GPXParser=o},function(t,e,o){"use strict";o.r(e);var a=o(0),r=o.n(a);var n=o(1),i=o.n(n),s=o(3),l=function(t){var e,o;function a(){return t.apply(this,arguments)||this}o=t,(e=a).prototype=Object.create(o.prototype),e.prototype.constructor=e,e.__proto__=o;var r=a.prototype;return r.apiEndpoint=function(){return"/fof/uploads"+(this.exists?"/"+this.data.id:"")},r.bbcode=function(){switch(console.log("checking"),console.log(this.tag()),this.tag()){case"gpx":return"[upl-file uuid="+this.uuid()+" size="+this.humanSize()+" url="+this.url()+"]"+this.baseName()+"[/upl-file]";case"file":return"[upl-file uuid="+this.uuid()+" size="+this.humanSize()+"]"+this.baseName()+"[/upl-this]";case"image":return"[upl-image uuid="+this.uuid()+" size="+this.humanSize()+" url="+this.url()+"]"+this.baseName()+"[/upl-image]";case"image-preview":return"[upl-image-preview url="+this.url()+"]";default:return this.url()}},a}(o.n(s)()(i.a,{baseName:i.a.attribute("baseName"),path:i.a.attribute("path"),url:i.a.attribute("url"),type:i.a.attribute("type"),size:i.a.attribute("size"),humanSize:i.a.attribute("humanSize"),createdAt:i.a.attribute("createdAt"),uuid:i.a.attribute("uuid"),tag:i.a.attribute("tag"),hidden:i.a.attribute("hidden")})),u=o(2),p=o(4),c=o.n(p),g=o(5),d=o.n(g),m=function(){Object(u.extend)(c.a.prototype,"oncreate",(function(){var t=this.attrs.post.id();this.$(".gpxFile").each((function(e){var o=r.a.forum.attribute("apiUrl")+"/fof/download";o+="/"+$(this).data("fofUploadDownloadUuid"),o+="/"+t,o+="/"+r.a.session.csrfToken;var a="map-"+$(this).data("fofUploadDownloadUuid");console.debug(o),console.debug(a);!function(t,e){$.ajax({url:e,dataType:"xml",success:function(o){console.debug("parsing GPS file "+e);var a=new d.a.GPXParser(o,t);a.setTrackColour("#ff0000"),a.setTrackWidth(5),a.setMinTrackPointDelta(.001),a.centerAndZoom(o),a.addTrackpointsToMap(),a.addRoutepointsToMap(),a.addWaypointsToMap()}})}(new google.maps.Map(document.getElementById(a),{zoom:8,mapTypeId:"roadmap"}),o)}))}))};console.debug("GPX Preview Scanning..."),r.a.initializers.add("gpx-preview",(function(){m(),r.a.store.models.files=l}))}]);
//# sourceMappingURL=forum.js.map