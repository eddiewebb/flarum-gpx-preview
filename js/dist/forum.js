module.exports=function(t){var e={};function o(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=t,o.c=e,o.d=function(t,e,a){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(a,n,function(e){return t[e]}.bind(null,n));return a},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=4)}([function(t,e){t.exports=flarum.core.compat.app},function(t,e){t.exports=flarum.core.compat.extend},function(t,e){t.exports=flarum.core.compat["components/Post"]},function(t,e){function o(t,e){this.xmlDoc=t,this.map=e,this.trackcolour="#ff00ff",this.trackwidth=5,this.mintrackpointdelta=1e-4}o.prototype.setTrackColour=function(t){this.trackcolour=t},o.prototype.setTrackWidth=function(t){this.trackwidth=t},o.prototype.setMinTrackPointDelta=function(t){this.mintrackpointdelta=t},o.prototype.translateName=function(t){return"wpt"==t?"Waypoint":"trkpt"==t?"Track Point":"rtept"==t?"Route Point":void 0},o.prototype.createMarker=function(t){var e=parseFloat(t.getAttribute("lon")),o=parseFloat(t.getAttribute("lat")),a="",n=t.getElementsByTagName("html");if(n.length>0)for(i=0;i<n.item(0).childNodes.length;i++)a+=n.item(0).childNodes[i].nodeValue;else{a="<b>"+this.translateName(t.nodeName)+"</b><br>";var r=t.attributes,s=r.length;for(i=0;i<s;i++)a+=r.item(i).name+" = "+r.item(i).nodeValue+"<br>";if(t.hasChildNodes){var l=t.childNodes,p=l.length;for(i=0;i<p;i++)1==l[i].nodeType&&null!=l[i].firstChild&&(a+=l[i].nodeName+" = "+l[i].firstChild.nodeValue+"<br>")}}var g=new google.maps.Marker({position:new google.maps.LatLng(o,e),map:this.map}),u=new google.maps.InfoWindow({content:a,size:new google.maps.Size(50,50)});google.maps.event.addListener(g,"click",(function(){u.open(this.map,g)}))},o.prototype.addTrackSegmentToMap=function(t,e,o){var a=t.getElementsByTagName("trkpt");if(0!=a.length){var n=[],r=parseFloat(a[0].getAttribute("lon")),i=parseFloat(a[0].getAttribute("lat")),s=new google.maps.LatLng(i,r);n.push(s);for(var l=1;l<a.length;l++){var p=parseFloat(a[l].getAttribute("lon")),g=parseFloat(a[l].getAttribute("lat")),u=g-i,c=p-r;Math.sqrt(u*u+c*c)>this.mintrackpointdelta&&(r=p,i=g,s=new google.maps.LatLng(g,p),n.push(s))}new google.maps.Polyline({path:n,strokeColor:e,strokeWeight:o,map:this.map})}},o.prototype.addTrackToMap=function(t,e,o){for(var a=t.getElementsByTagName("trkseg"),n=0;n<a.length;n++)this.addTrackSegmentToMap(a[n],e,o)},o.prototype.addRouteToMap=function(t,e,o){var a=t.getElementsByTagName("rtept");if(0!=a.length){var n=[],r=parseFloat(a[0].getAttribute("lon")),i=parseFloat(a[0].getAttribute("lat")),s=new google.maps.LatLng(i,r);n.push(s);for(var l=1;l<a.length;l++){var p=parseFloat(a[l].getAttribute("lon")),g=parseFloat(a[l].getAttribute("lat")),u=g-i,c=p-r;Math.sqrt(u*u+c*c)>this.mintrackpointdelta&&(r=p,i=g,s=new google.maps.LatLng(g,p),n.push(s))}new google.maps.Polyline({path:n,strokeColor:e,strokeWeight:o,map:this.map})}},o.prototype.centerAndZoom=function(t){for(var e=new Array("trkpt","rtept","wpt"),o=0,a=0,n=0,r=0,i=0;i<e.length;i++){var s=t.getElementsByTagName(e[i]);s.length>0&&o==a&&0==o&&(o=parseFloat(s[0].getAttribute("lat")),a=parseFloat(s[0].getAttribute("lat")),n=parseFloat(s[0].getAttribute("lon")),r=parseFloat(s[0].getAttribute("lon")));for(var l=0;l<s.length;l++){var p=parseFloat(s[l].getAttribute("lon")),g=parseFloat(s[l].getAttribute("lat"));p<n&&(n=p),p>r&&(r=p),g<o&&(o=g),g>a&&(a=g)}}if(o!=a||0!=o){var u=(r+n)/2,c=(a+o)/2,d=new google.maps.LatLngBounds(new google.maps.LatLng(o,n),new google.maps.LatLng(a,r));this.map.setCenter(new google.maps.LatLng(c,u)),this.map.fitBounds(d)}else this.map.setCenter(new google.maps.LatLng(49.327667,-122.942333),14)},o.prototype.centerAndZoomToLatLngBounds=function(t){for(var e=new google.maps.LatLngBounds,o=0;o<t.length;o++)t[o].isEmpty()||(e.extend(t[o].getSouthWest()),e.extend(t[o].getNorthEast()));var a=(e.getNorthEast().lat()+e.getSouthWest().lat())/2,n=(e.getNorthEast().lng()+e.getSouthWest().lng())/2;this.map.setCenter(new google.maps.LatLng(a,n),this.map.getBoundsZoomLevel(e))},o.prototype.addTrackpointsToMap=function(){for(var t=this.xmlDoc.documentElement.getElementsByTagName("trk"),e=0;e<t.length;e++)this.addTrackToMap(t[e],this.trackcolour,this.trackwidth)},o.prototype.addWaypointsToMap=function(){for(var t=this.xmlDoc.documentElement.getElementsByTagName("wpt"),e=0;e<t.length;e++)this.createMarker(t[e])},o.prototype.addRoutepointsToMap=function(){for(var t=this.xmlDoc.documentElement.getElementsByTagName("rte"),e=0;e<t.length;e++)this.addRouteToMap(t[e],this.trackcolour,this.trackwidth)},e.GPXParser=o},function(t,e,o){"use strict";o.r(e);var a=o(0),n=o.n(a),r=o(1),i=o(2),s=o.n(i),l=o(3),p=o.n(l),g=function(){Object(r.extend)(s.a.prototype,"oncreate",(function(){var t=this.attrs.post.id();this.$(".gpxFile").each((function(e){var o=n.a.forum.attribute("apiUrl")+"/fof/download";o+="/"+$(this).data("fofUploadDownloadUuid"),o+="/"+t,o+="/"+n.a.session.csrfToken;var a="map-"+$(this).data("fofUploadDownloadUuid");console.debug(o),console.debug(a);!function(t,e){$.ajax({url:e,dataType:"xml",success:function(o){console.debug("parsing GPS file "+e);var a=new p.a.GPXParser(o,t);a.setTrackColour("#ff0000"),a.setTrackWidth(5),a.setMinTrackPointDelta(.001),a.centerAndZoom(o),a.addTrackpointsToMap(),a.addRoutepointsToMap(),a.addWaypointsToMap()}})}(new google.maps.Map(document.getElementById(a),{zoom:8,mapTypeId:"roadmap"}),o)}))}))};console.debug("GPX Preview Scanning..."),n.a.initializers.add("gpx-preview",(function(){g()}))}]);
//# sourceMappingURL=forum.js.map